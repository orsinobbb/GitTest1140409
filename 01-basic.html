<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>01. åŸºç¤åŠŸèƒ½æ¸¬è©¦</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
  <div class="container">
    <div class="nav-links">
      <a href="index.html">â† å›é¦–é </a>
      <a href="02-compute.html">ä¸‹ä¸€å€‹ â†’</a>
    </div>

    <h1>01. åŸºç¤åŠŸèƒ½æ¸¬è©¦</h1>
    <p class="subtitle">DOM æ“ä½œã€äº‹ä»¶è™•ç†ã€Python â†” JS äº’é€š</p>

    <div class="info">
      <strong>ğŸ¯ æ¸¬è©¦é‡é»</strong>
      <p>é©—è­‰ PyScript çš„åŸºæœ¬äº’å‹•èƒ½åŠ›ï¼Œé€™äº›æ˜¯æ‰€æœ‰æ‡‰ç”¨çš„åŸºç¤</p>
    </div>

    <!-- è¼‰å…¥ç‹€æ…‹ -->
    <div class="card">
      <h3>è¼‰å…¥ç‹€æ…‹ç›£æ¸¬</h3>
      <div class="row">
        <span class="status-indicator status-loading" id="status-dot"></span>
        <span id="status-text">PyScript è¼‰å…¥ä¸­...</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="load-progress" style="width: 0%"></div>
      </div>
    </div>

    <!-- æ¸¬è©¦ 1: DOM æ“ä½œ -->
    <div class="card">
      <h3>æ¸¬è©¦ 1: DOM æ“ä½œ</h3>
      <p>é©—è­‰ Python èƒ½å¦è®€å¯« HTML å…ƒç´ </p>
      <div class="row">
        <input type="text" id="input1" placeholder="è¼¸å…¥ä¸€äº›æ–‡å­—..." value="Hello PyScript">
        <button id="btn-update">æ›´æ–°é¡¯ç¤º</button>
        <button id="btn-clear">æ¸…ç©º</button>
      </div>
      <div class="output-box" id="output1">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <!-- æ¸¬è©¦ 2: äº‹ä»¶è™•ç† -->
    <div class="card">
      <h3>æ¸¬è©¦ 2: äº‹ä»¶è™•ç†</h3>
      <p>æ¸¬è©¦å„ç¨® DOM äº‹ä»¶çš„ç¶å®šèˆ‡éŸ¿æ‡‰</p>
      <div class="row">
        <button id="btn-click">é»æ“Šäº‹ä»¶</button>
        <button id="btn-dblclick">é›™æ“Šäº‹ä»¶</button>
        <button id="btn-context">å³éµäº‹ä»¶</button>
      </div>
      <div class="row">
        <input type="range" id="slider" min="0" max="100" value="50">
        <span id="slider-value">50</span>
      </div>
      <div class="output-box" id="output2">ç­‰å¾…äº‹ä»¶è§¸ç™¼...</div>
    </div>

    <!-- æ¸¬è©¦ 3: Python â†” JS äº’é€š -->
    <div class="card">
      <h3>æ¸¬è©¦ 3: Python â†” JS è³‡æ–™å‚³é</h3>
      <p>æ¸¬è©¦å…©ç¨®èªè¨€ä¹‹é–“çš„è³‡æ–™äº¤æ›</p>
      <div class="row">
        <button id="btn-py-to-js">Python â†’ JS</button>
        <button id="btn-js-to-py">JS â†’ Python</button>
        <button id="btn-complex">è¤‡é›œè³‡æ–™çµæ§‹</button>
      </div>
      <div class="output-box" id="output3">ç­‰å¾…è³‡æ–™å‚³é...</div>
    </div>

    <!-- æ¸¬è©¦ 4: å‹•æ…‹å…ƒç´ å‰µå»º -->
    <div class="card">
      <h3>æ¸¬è©¦ 4: å‹•æ…‹ HTML ç”Ÿæˆ</h3>
      <p>Python å‹•æ…‹å‰µå»º DOM å…ƒç´ </p>
      <div class="row">
        <input type="number" id="num-items" value="5" min="1" max="20">
        <button id="btn-generate">ç”Ÿæˆåˆ—è¡¨</button>
        <button id="btn-remove">æ¸…ç©ºåˆ—è¡¨</button>
      </div>
      <div id="dynamic-content"></div>
    </div>

    <!-- æ¸¬è©¦ 5: æ¨£å¼æ“ä½œ -->
    <div class="card">
      <h3>æ¸¬è©¦ 5: CSS æ¨£å¼æ§åˆ¶</h3>
      <p>Python ä¿®æ”¹å…ƒç´ æ¨£å¼</p>
      <div class="row">
        <button id="btn-color-red">ç´…è‰²</button>
        <button id="btn-color-blue">è—è‰²</button>
        <button id="btn-color-green">ç¶ è‰²</button>
        <button id="btn-animate">å‹•ç•«æ•ˆæœ</button>
      </div>
      <div id="style-box" style="width: 200px; height: 100px; background: #eee; border-radius: 8px; margin: 15px 0; transition: all 0.5s;"></div>
    </div>

    <!-- æ•ˆèƒ½çµ±è¨ˆ -->
    <div class="card">
      <h3>æ•ˆèƒ½çµ±è¨ˆ</h3>
      <div class="grid">
        <div class="metric">
          <div class="metric-value" id="event-count">0</div>
          <div class="metric-label">äº‹ä»¶è§¸ç™¼æ¬¡æ•¸</div>
        </div>
        <div class="metric">
          <div class="metric-value" id="dom-ops">0</div>
          <div class="metric-label">DOM æ“ä½œæ¬¡æ•¸</div>
        </div>
        <div class="metric">
          <div class="metric-value" id="load-time">--</div>
          <div class="metric-label">è¼‰å…¥æ™‚é–“ (ç§’)</div>
        </div>
      </div>
    </div>

  </div>

  <!-- PyScript å€åŸŸ -->
  <py-script>
from pyscript import document, window
import time
import json

# è¼‰å…¥è¨ˆæ™‚
start_time = time.time()

# çµ±è¨ˆè®Šæ•¸
event_count = 0
dom_ops = 0

def update_stats():
    global dom_ops
    dom_ops += 1
    document.querySelector("#event-count").innerText = str(event_count)
    document.querySelector("#dom-ops").innerText = str(dom_ops)

# æ¸¬è©¦ 1: DOM æ“ä½œ
def update_output(*args):
    global event_count
    event_count += 1
    input_val = document.querySelector("#input1").value
    output = document.querySelector("#output1")
    output.innerText = f"[{time.strftime('%H:%M:%S')}] ä½ è¼¸å…¥äº†: {input_val}\nå­—å…ƒæ•¸: {len(input_val)}"
    update_stats()

def clear_input(*args):
    global event_count
    event_count += 1
    document.querySelector("#input1").value = ""
    document.querySelector("#output1").innerText = "å·²æ¸…ç©º"
    update_stats()

# æ¸¬è©¦ 2: äº‹ä»¶è™•ç†
def handle_click(*args):
    global event_count
    event_count += 1
    output = document.querySelector("#output2")
    output.innerText = f"[{time.strftime('%H:%M:%S')}] å–®æ“Šäº‹ä»¶è§¸ç™¼ï¼"
    update_stats()

def handle_dblclick(*args):
    global event_count
    event_count += 1
    output = document.querySelector("#output2")
    output.innerText = f"[{time.strftime('%H:%M:%S')}] é›™æ“Šäº‹ä»¶è§¸ç™¼ï¼"
    update_stats()

def handle_context(event):
    global event_count
    event_count += 1
    event.preventDefault()
    output = document.querySelector("#output2")
    output.innerText = f"[{time.strftime('%H:%M:%S')}] å³éµé¸å–®è¢«æ””æˆªï¼"
    update_stats()

def handle_slider(*args):
    global event_count
    event_count += 1
    value = document.querySelector("#slider").value
    document.querySelector("#slider-value").innerText = value
    update_stats()

# æ¸¬è©¦ 3: Python â†” JS è³‡æ–™å‚³é
def py_to_js(*args):
    global event_count
    event_count += 1
    
    # Python å‰µå»ºè³‡æ–™
    data = {
        "message": "é€™æ˜¯å¾ Python å‚³ä¾†çš„è³‡æ–™",
        "timestamp": time.time(),
        "list": [1, 2, 3, 4, 5],
        "nested": {"key": "value"}
    }
    
    # å‚³çµ¦ JSï¼ˆä½¿ç”¨ window çš„å…¨åŸŸè®Šæ•¸ï¼‰
    window.pyData = data
    
    # å‘¼å« JS å‡½æ•¸
    window.displayPyData()
    update_stats()

def js_to_py(*args):
    global event_count
    event_count += 1
    
    # è§¸ç™¼ JS å‡½æ•¸ï¼Œè®“å®ƒè¨­å®šè³‡æ–™
    window.sendDataToPython()
    update_stats()

def complex_data(*args):
    global event_count
    event_count += 1
    
    import numpy as np
    
    # å‰µå»º numpy array
    arr = np.array([1, 2, 3, 4, 5])
    
    output = document.querySelector("#output3")
    output.innerText = f"""
Python numpy array:
{arr}

è½‰æ›ç‚º list: {arr.tolist()}
å¹³å‡å€¼: {arr.mean()}
ç¸½å’Œ: {arr.sum()}

æ³¨æ„ï¼šnumpy array ä¸èƒ½ç›´æ¥å‚³çµ¦ JSï¼Œéœ€è¦å…ˆè½‰æ›ç‚º list
"""
    update_stats()

# æ¸¬è©¦ 4: å‹•æ…‹å…ƒç´ å‰µå»º
def generate_items(*args):
    global event_count, dom_ops
    event_count += 1
    
    num = int(document.querySelector("#num-items").value)
    container = document.querySelector("#dynamic-content")
    container.innerHTML = ""
    
    for i in range(num):
        item = document.createElement("div")
        item.className = "card"
        item.style.padding = "10px"
        item.style.margin = "5px 0"
        item.innerHTML = f"""
            <strong>é …ç›® {i+1}</strong>
            <p>é€™æ˜¯ç”± Python å‹•æ…‹ç”Ÿæˆçš„å…ƒç´ </p>
            <button onclick="alert('é …ç›® {i+1} è¢«é»æ“Š')">é»æˆ‘</button>
        """
        container.appendChild(item)
        dom_ops += 1
    
    update_stats()

def remove_items(*args):
    global event_count
    event_count += 1
    document.querySelector("#dynamic-content").innerHTML = ""
    update_stats()

# æ¸¬è©¦ 5: æ¨£å¼æ“ä½œ
def set_color(color):
    def handler(*args):
        global event_count
        event_count += 1
        box = document.querySelector("#style-box")
        box.style.background = color
        update_stats()
    return handler

def animate_box(*args):
    global event_count
    event_count += 1
    box = document.querySelector("#style-box")
    
    # éš¨æ©Ÿè®Šæ›
    import random
    box.style.width = f"{random.randint(100, 400)}px"
    box.style.height = f"{random.randint(50, 200)}px"
    box.style.borderRadius = f"{random.randint(0, 50)}px"
    box.style.transform = f"rotate({random.randint(-15, 15)}deg)"
    
    update_stats()

# ç¶å®šäº‹ä»¶
document.querySelector("#btn-update").addEventListener("click", update_output)
document.querySelector("#btn-clear").addEventListener("click", clear_input)

document.querySelector("#btn-click").addEventListener("click", handle_click)
document.querySelector("#btn-dblclick").addEventListener("dblclick", handle_dblclick)
document.querySelector("#btn-context").addEventListener("contextmenu", handle_context)
document.querySelector("#slider").addEventListener("input", handle_slider)

document.querySelector("#btn-py-to-js").addEventListener("click", py_to_js)
document.querySelector("#btn-js-to-py").addEventListener("click", js_to_py)
document.querySelector("#btn-complex").addEventListener("click", complex_data)

document.querySelector("#btn-generate").addEventListener("click", generate_items)
document.querySelector("#btn-remove").addEventListener("click", remove_items)

document.querySelector("#btn-color-red").addEventListener("click", set_color("#ff6b6b"))
document.querySelector("#btn-color-blue").addEventListener("click", set_color("#4dabf7"))
document.querySelector("#btn-color-green").addEventListener("click", set_color("#51cf66"))
document.querySelector("#btn-animate").addEventListener("click", animate_box)

# åˆå§‹åŒ–å®Œæˆ
end_time = time.time()
load_time = end_time - start_time

document.querySelector("#status-dot").className = "status-indicator status-ready"
document.querySelector("#status-text").innerText = "PyScript å·²å°±ç·’"
document.querySelector("#load-progress").style.width = "100%"
document.querySelector("#load-time").innerText = f"{load_time:.2f}"

print(f"âœ… åŸºç¤åŠŸèƒ½æ¨¡çµ„è¼‰å…¥å®Œæˆ ({load_time:.2f}s)")
  </py-script>

  <!-- JS è¼”åŠ©å‡½æ•¸ -->
  <script>
    // æ¨¡æ“¬è¼‰å…¥é€²åº¦
    let progress = 0;
    const interval = setInterval(() => {
      progress += 2;
      if (progress >= 90) {
        clearInterval(interval);
      }
      document.getElementById("load-progress").style.width = progress + "%";
    }, 100);

    // Python å‘¼å«çš„ JS å‡½æ•¸
    function displayPyData() {
      const output = document.querySelector("#output3");
      const data = window.pyData;
      output.innerText = `JS æ”¶åˆ° Python çš„è³‡æ–™ï¼š\n${JSON.stringify(data, null, 2)}`;
    }

    function sendDataToPython() {
      const jsData = {
        message: "é€™æ˜¯å¾ JS å‚³ä¾†çš„è³‡æ–™",
        timestamp: new Date().getTime(),
        userAgent: navigator.userAgent
      };
      
      // è¨­å®šåˆ° window è®“ Python å¯ä»¥è®€å–
      window.jsData = jsData;
      
      const output = document.querySelector("#output3");
      output.innerText = `Python å¯ä»¥é€é window.jsData è®€å–ï¼š\n${JSON.stringify(jsData, null, 2)}`;
    }
  </script>
</body>
</html>
