<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>Orsino FaceMesh AR (iPhone 16 Pro OK)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

  <!-- Mediapipe FaceMesh -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/facemesh/facemesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <video id="video" playsinline style="display:none;"></video>
  <canvas id="canvas" style="position: fixed; left:0; top:0;"></canvas>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    async function start() {
      video.width = window.innerWidth;
      video.height = window.innerHeight;

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "user" }
      });
      video.srcObject = stream;
      await video.play();

      const facemesh = new facemesh.FaceMesh({
        maxFaces: 1,
        refineLandmarks: true
      });

      facemesh.onResults(results => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        if (!results.multiFaceLandmarks[0]) return;

        const face = results.multiFaceLandmarks[0];

        // example: draw glasses (simple)
        const leftEye = face[33];
        const rightEye = face[263];

        ctx.strokeStyle = "cyan";
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.moveTo(leftEye.x * canvas.width, leftEye.y * canvas.height);
        ctx.lineTo(rightEye.x * canvas.width, rightEye.y * canvas.height);
        ctx.stroke();
      });

      const camera = new Camera(video, {
        onFrame: async () => {
          await facemesh.send({image: video});
        },
        width: window.innerWidth,
        height: window.innerHeight
      });
      camera.start();
    }

    start();
  </script>
</body>
</html>